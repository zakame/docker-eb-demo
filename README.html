<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Docker on AWS</title>
<meta name="author" content="(Zak B. Elep)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/night.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/reveal.js/3.0.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Docker on AWS</h1><h2 class="author">Zak B. Elep</h2><h2 class="email"><a href="mailto:zak.elep@yoyo-holdings.com">zak.elep@yoyo-holdings.com</a></h2><p class="date">Created: 2016-08-23 Tue 17:04</p>
</section>
<p>
<a href="https://github.com/zakame/docker-eb-demo">https://github.com/zakame/docker-eb-demo</a>
</p>

<section>
<section id="slide-orgheadline1">
<h2 id="orgheadline1">About Me</h2>
<ul>
<li>@zakame in GitHub, Twitter, FB</li>
<li>Co-Founder, Chief Architect, YOYO Holdings</li>
<li>Recovering Sysadmin</li>
<li>Hacks on Perl, Docker, Emacs, Android</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgheadline2">
<h2 id="orgheadline2">What's this for?</h2>
<ul>
<li>Short intro on using Docker on AWS via Elastic Beanstalk</li>
<li>Assumes some familiarity with Docker ecosystem</li>
<li>Assumes some familiarity with AWS infra (EC2/S3, ELB, Beanstalk)</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgheadline6">
<h2 id="orgheadline6">Why Docker on Elastic Beanstalk?</h2>
<ul>
<li>Distribution</li>
<li>Maintenance</li>
<li>Development</li>

</ul>

</section>
<section id="slide-orgheadline3">
<h3 id="orgheadline3">Distribution</h3>
<ul>
<li>Software systems as containers</li>
<li>(Mostly) standalone systems (especially for exotic setups)</li>
<li>(Mostly) less chance of incompatibilities/inconsistencies</li>

</ul>

</section>
<section id="slide-orgheadline4">
<h3 id="orgheadline4">Maintenance</h3>
<ul>
<li>Growing from "pet to cattle" setups</li>
<li>Reducing moving targets (e.g. external dependencies)</li>
<li>Redundancy (e.g. <code>eb swap</code>, ELB)</li>

</ul>

</section>
<section id="slide-orgheadline5">
<h3 id="orgheadline5">Development</h3>
<ul>
<li>Builds up on distribution and maintenance merits</li>
<li>Correlate code history with system history (e.g. git vs docker commits)</li>
<li>Leverage other AWS solutions (e.g. RDS, Lambda)</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgheadline12">
<h2 id="orgheadline12">Demo: Cat GIFs!</h2>
<p>
<a href="http://cats.zakame.org">http://cats.zakame.org</a>
</p>

<p>
See github above ;)
</p>

</section>
<section id="slide-orgheadline7">
<h3 id="orgheadline7">Point to Elastic Beanstalk DNS</h3>
<div class="org-src-container">

<pre  class="src src-sh">dig +short cats.zakame.org.
</pre>
</div>

<pre class="example">
zakame-cats-prod.us-east-1.elasticbeanstalk.com.
54.225.221.170
50.17.210.230
</pre>

</section>
<section id="slide-orgheadline8">
<h3 id="orgheadline8">A Simple Perl app</h3>
<div class="org-src-container">

<pre  class="src src-perl"><span style="color: #6089a0; font-weight: bold;">use</span> <span style="color: #b2aa82;">Plack::Builder</span>;

<span style="color: #6089a0; font-weight: bold;">my</span> <span style="color: #6089a0;">@images</span> = &lt;DATA&gt;;

<span style="color: #4677a0;"># </span><span style="color: #4677a0;">Its dangerous, take a cat with you!</span>
builder <span style="color: #696969;">{</span>
    mount <span style="color: #a09a61;">'/'</span> =&gt; builder <span style="color: #696969;">{</span>
        enable <span style="color: #a09a61;">'TMT'</span>,
            <span style="color: #a09a61;">include_path</span> =&gt; <span style="color: #a09a61;">'tmpl'</span>,
            <span style="color: #a09a61;">macro</span> =&gt; +<span style="color: #696969;">{</span>
                <span style="color: #a09a61;">url</span> =&gt; <span style="color: #6089a0; font-weight: bold;">sub</span> <span style="color: #696969;">{</span> <span style="color: #6089a0;">$images</span><span style="color: #696969;">[</span><span style="color: #98a088;">int</span> <span style="color: #98a088;">rand</span> <span style="color: #6089a0;">@images</span><span style="color: #696969;">]</span> <span style="color: #696969;">}</span>,
            <span style="color: #696969;">}</span>;
    <span style="color: #696969;">}</span>;
<span style="color: #696969;">}</span>;

<span style="color: #4677a0;">__DATA__</span>
http:<span style="color: #6089a0; font-weight: bold;">//</span><span style="color: #dfdbc1;">ak</span>-hdl.buzzfed.com/static/2013-10/enhanced/webdr05/15/9/anigif_enhanced-buzz-26388-1381844103-11.gif
http:<span style="color: #6089a0; font-weight: bold;">//</span><span style="color: #dfdbc1;">ak</span>-hdl.buzzfed.com/static/2013-10/enhanced/webdr01/15/9/anigif_enhanced-buzz-31540-1381844535-8.gif
http:<span style="color: #6089a0; font-weight: bold;">//</span><span style="color: #dfdbc1;">ak</span>-hdl.buzzfed.com/static/2013-10/enhanced/webdr05/15/9/anigif_enhanced-buzz-26390-1381844163-18.gif
</pre>
</div>

</section>
<section id="slide-orgheadline9">
<h3 id="orgheadline9">A Simple Dockerfile</h3>
<div class="org-src-container">

<pre  class="src src-dockerfile"><span style="color: #4677a0;"># </span><span style="color: #4677a0;">our base image</span>
<span style="color: #6089a0; font-weight: bold;">FROM</span> perl:5.24.0

<span style="color: #4677a0;"># </span><span style="color: #4677a0;">install Carton</span>
<span style="color: #6089a0; font-weight: bold;">RUN</span> cpanm Carton

<span style="color: #4677a0;"># </span><span style="color: #4677a0;">install CPAN modules needed by the Perl app</span>
<span style="color: #6089a0; font-weight: bold;">COPY</span> cpanfile* /usr/src/app/
<span style="color: #6089a0; font-weight: bold;">WORKDIR</span> /usr/src/app
<span style="color: #6089a0; font-weight: bold;">RUN</span> carton install --deployment

<span style="color: #4677a0;"># </span><span style="color: #4677a0;">copy files required for the app to run</span>
<span style="color: #6089a0; font-weight: bold;">COPY</span> app.psgi /usr/src/app
<span style="color: #6089a0; font-weight: bold;">COPY</span> tmpl/index /usr/src/app/tmpl/

<span style="color: #4677a0;"># </span><span style="color: #4677a0;">tell the port number the container should expose</span>
<span style="color: #6089a0; font-weight: bold;">EXPOSE</span> 5000

<span style="color: #4677a0;"># </span><span style="color: #4677a0;">run the application</span>
<span style="color: #6089a0; font-weight: bold;">CMD</span> <span style="color: #696969;">[</span><span style="color: #a09a61;">"carton"</span>, <span style="color: #a09a61;">"exec"</span>, <span style="color: #a09a61;">"plackup"</span>, <span style="color: #a09a61;">"app.psgi"</span><span style="color: #696969;">]</span>
</pre>
</div>

</section>
<section id="slide-orgheadline10">
<h3 id="orgheadline10">Elastic Beanstalk setup</h3>
<div class="org-src-container">

<pre  class="src src-sh">pip install awsebcli
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-sh">eb init
eb create --cname zakame-cats-live blue
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-sh">eb status blue
</pre>
</div>

<pre class="example">
Environment details for: blue
  Application name: docker-eb-demo
  Region: us-east-1
  Deployed Version: app-160823_160301
  Environment ID: e-qmphs33nch
  Platform: 64bit Amazon Linux 2016.03 v2.1.3 running Docker 1.11.1
  Tier: WebServer-Standard
  CNAME: zakame-cats-prod.us-east-1.elasticbeanstalk.com
  Updated: 2016-08-23 08:15:08.455000+00:00
  Status: Ready
  Health: Green
</pre>

<div class="org-src-container">

<pre  class="src src-sh">eb ssh blue
</pre>
</div>

</section>
<section id="slide-orgheadline11">
<h3 id="orgheadline11">Blue-green setup</h3>
<div class="org-src-container">

<pre  class="src src-sh">eb clone --cname zakame-cats-test blue --clone_name green
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-sh">eb status green
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-sh">eb swap
</pre>
</div>

</section>
</section>
<section>
<section id="slide-orgheadline13">
<h2 id="orgheadline13">EB Dashboard</h2>
<p>
<a href="https://console.aws.amazon.com/elasticbeanstalk">https://console.aws.amazon.com/elasticbeanstalk</a>
</p>

</section>
</section>
<section>
<section id="slide-orgheadline14">
<h2 id="orgheadline14">Gotchas</h2>
<ul>
<li>Need <code>AWSElasticBeanstalkFullAccess</code> policy on IAM User when trying out
(don't do on prod though! <a href="http://stackoverflow.com/questions/31977441/aws-elastic-beanstalk-servicerole-error-when-logging-in-to-a-role">http://stackoverflow.com/questions/31977441/aws-elastic-beanstalk-servicerole-error-when-logging-in-to-a-role</a></li>

</ul>

</section>
</section>
<section>
<section id="slide-orgheadline15">
<h2 id="orgheadline15">More Information</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/console/elasticbeanstalk/get-started">Get Started using Elastic Beanstalk</a></li>
<li><a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_dockerpreconfig.walkthrough.html">Getting Started with Preconfigured Docker Containers</a></li>
<li><a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker.html">Deploying Elastic Beanstalk Applications from Docker Containers</a></li>

</ul>

</section>
</section>
<section>
<section id="slide-orgheadline16">
<h2 id="orgheadline16">Finis</h2>

<div class="figure">
<p><img src="http://25.media.tumblr.com/tumblr_li7qqi3qDc1qcn249o1_400.gif" alt="tumblr_li7qqi3qDc1qcn249o1_400.gif"></p>
</div>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
<script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
